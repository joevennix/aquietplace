<!--
  A localStorage shim for schemes that don't support it,
  like data: in Chrome.
-->
<!doctype html>
<html>
<body>
<script>
window.onmessage = function(e) {
	// simply evaluate and send back the result.
	var data = JSON.parse(e.data);
	var origin = e.origin || 'data://';
	var key = data.key;
	var value = null;

	if (data) {
		if (data.set) {
			localStorage[origin] = localStorage[origin] || {};
			localStorage[origin][e.data.key] = data.value;
		} else if (data.get) {
			value = localStorage[origin] && localStorage[origin][key];
			e.source.postMessage(JSON.stringify({value: value, key: key}), e.origin || '*');
		}
	}
};
</script>
</body>
</html>